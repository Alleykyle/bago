{% load static %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DILG Analytics Dashboard</title>
  <link rel="stylesheet" href="{% static 'CSS/dashboard.css' %}">
  <link rel="stylesheet" href="{% static 'CSS/theme-system.css' %}">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <style>
    /* Enhanced Dashboard Styles */
    .analytics-card {
      background: var(--card-bg, #ffffff);
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
      border: 1px solid var(--border-color, #e5e7eb);
      transition: all var(--transition-duration, 0.3s) ease;
    }

    .analytics-card:hover {
      box-shadow: 0 8px 30px rgba(0,0,0,0.12);
      transform: translateY(-2px);
    }

    .stat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .stat-title {
      font-size: 1.1em;
      font-weight: 600;
      color: var(--text-primary, #1f2937);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .stat-icon {
      font-size: 1.3em;
    }

    .stat-number {
      font-size: 2.5em;
      font-weight: bold;
      color: var(--accent-color, #3b82f6);
      margin: 12px 0;
      line-height: 1;
    }

    .stat-change {
      font-size: 0.9em;
      padding: 4px 8px;
      border-radius: 6px;
      font-weight: 500;
    }

    .stat-increase {
      color: #059669;
      background: #ecfdf5;
    }

    .stat-decrease {
      color: #dc2626;
      background: #fef2f2;
    }

    .chart-container {
      position: relative;
      height: 300px;
      margin-top: 20px;
    }

    .activity-log {
      max-height: 400px;
      overflow-y: auto;
    }

    .activity-item {
      display: flex;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid var(--border-color, #e5e7eb);
      transition: background-color var(--transition-duration, 0.3s);
    }

    .activity-item:hover {
      background-color: var(--hover-bg, #f9fafb);
      margin: 0 -12px;
      padding-left: 12px;
      padding-right: 12px;
      border-radius: 8px;
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 12px;
      font-weight: bold;
      color: white;
      font-size: 0.9em;
    }

    .activity-create { background: linear-gradient(135deg, #10b981, #059669); }
    .activity-update { background: linear-gradient(135deg, #f59e0b, #d97706); }
    .activity-delete { background: linear-gradient(135deg, #ef4444, #dc2626); }
    .activity-login { background: linear-gradient(135deg, #3b82f6, #2563eb); }

    .activity-content {
      flex: 1;
    }

    .activity-description {
      font-weight: 500;
      color: var(--text-primary, #1f2937);
      margin-bottom: 4px;
    }

    .activity-time {
      font-size: 0.85em;
      color: var(--text-secondary, #6b7280);
    }

    .performance-metrics {
      display: grid;
      gap: 12px;
    }

    .metric-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
    }

    .metric-label {
      font-weight: 500;
      color: var(--text-primary, #1f2937);
    }

    .metric-value {
      color: var(--text-secondary, #6b7280);
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
    }

    .refresh-indicator {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background: linear-gradient(135deg, #3b82f6, #1d4ed8);
      border: none;
      border-radius: 50%;
      width: 56px;
      height: 56px;
      color: white;
      font-size: 1.2em;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
      transition: all var(--transition-duration, 0.3s);
      z-index: 1000;
    }

    .refresh-indicator:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 25px rgba(59, 130, 246, 0.4);
    }

    .refresh-indicator.spinning {
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    .grid-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px;
      margin-top: 24px;
    }

    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .no-data {
      text-align: center;
      color: var(--text-secondary, #6b7280);
      padding: 40px 20px;
      font-style: italic;
    }

    .error-message {
      background: #fee2e2;
      color: #dc2626;
      padding: 12px;
      border-radius: 8px;
      margin: 10px 0;
      border: 1px solid #fecaca;
    }

    /* Dark theme support */
    [data-theme="dark"] .analytics-card {
      background: var(--card-bg, #1f2937);
      border-color: var(--border-color, #374151);
    }

    [data-theme="dark"] .stat-increase {
      color: #34d399;
      background: rgba(52, 211, 153, 0.1);
    }

    [data-theme="dark"] .stat-decrease {
      color: #f87171;
      background: rgba(248, 113, 113, 0.1);
    }

    [data-theme="dark"] .error-message {
      background: rgba(220, 38, 38, 0.1);
      color: #f87171;
      border-color: rgba(248, 113, 113, 0.2);
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .analytics-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .chart-container {
        height: 250px;
      }
      
      .stat-number {
        font-size: 2em;
      }
    }

    .quick-action-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      transition: all var(--transition-duration, 0.3s);
      border: none;
      cursor: pointer;
      width: 100%;
      justify-content: flex-start;
      font-size: 14px;
    }

    .quick-action-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }

    .quick-action-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <!-- Sidebar -->
    <div class="sidebar">
      <img src="{% static 'Pictures/logo1.png' %}" alt="DILG Logo" class="logo">
      <div class="menu-title">Menu</div>
      <ul class="nav-menu">
        <li><a href="{% url 'dashboard' %}" {% if request.resolver_match.url_name == 'dashboard' %}class="active"{% endif %}>Dashboard</a></li>
        <li><a href="{% url 'application_request' %}" {% if request.resolver_match.url_name == 'application_request' %}class="active"{% endif %}>Application Request</a></li>
        <li><a href="{% url 'history' %}" {% if request.resolver_match.url_name == 'history' %}class="active"{% endif %}>History</a></li>
        <li><a href="{% url 'employees_profile' %}" {% if request.resolver_match.url_name == 'employees_profile' %}class="active"{% endif %}>Employees Profile</a></li>
        <li><a href="{% url 'folder' %}" {% if request.resolver_match.url_name == 'folder' %}class="active"{% endif %}>Folders</a></li>
        <li><a href="{% url 'settings' %}" {% if request.resolver_match.url_name == 'settings' %}class="active"{% endif %}>Settings</a></li>
      </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <div class="header">
        <h1>Analytics Dashboard</h1>
        <div style="display: flex; gap: 12px; align-items: center;">
          <span style="font-size: 0.9em; color: var(--text-secondary);">
            Last updated: <span id="lastUpdated">{% now "M d, H:i" %}</span>
          </span>
          <a href="{% url 'landing_menu' %}" class="back-button">‚Üê Back</a>
        </div>
      </div>

      <!-- Key Statistics -->
      <div class="analytics-grid">
        <div class="analytics-card">
          <div class="stat-header">
            <div class="stat-title">
              <span class="stat-icon">üë•</span>
              Total Employees
            </div>
          </div>
          <div class="stat-number" id="totalEmployees">{{ total_employees|default:0 }}</div>
          <div class="stat-change stat-increase">
            +{{ new_employees_30d|default:0 }} this month
          </div>
        </div>

        <div class="analytics-card">
          <div class="stat-header">
            <div class="stat-title">
              <span class="stat-icon">‚úÖ</span>
              Active Employees
            </div>
          </div>
          <div class="stat-number" id="activeEmployees">{{ active_employees|default:0 }}</div>
          <div class="stat-change stat-increase">
            {% if total_employees and total_employees > 0 %}
              {% widthratio active_employees total_employees 100 %}% active rate
            {% else %}
              0% active rate
            {% endif %}
          </div>
        </div>

        <div class="analytics-card">
          <div class="stat-header">
            <div class="stat-title">
              <span class="stat-icon">üìà</span>
              New This Month
            </div>
          </div>
          <div class="stat-number" id="newEmployees">{{ new_employees_30d|default:0 }}</div>
          <div class="stat-change stat-increase">
            Growth trend
          </div>
        </div>


        <!-- Task Distribution -->
        <div class="analytics-card">
          <div class="stat-title">
            <span class="stat-icon">üìã</span>
            Top Task Assignments
          </div>
          <div class="chart-container">
            {% if task_stats %}
              <canvas id="taskChart"></canvas>
            {% else %}
              <div class="no-data">No task data available</div>
            {% endif %}
          </div>
        </div>

        <!-- System Performance -->
        <div class="analytics-card">
          <div class="stat-title">
            <span class="stat-icon">‚ö°</span>
            System Performance
          </div>
          <div class="performance-metrics">
            <div class="metric-row">
              <span class="metric-label">Database Tables</span>
              <span class="metric-value">{{ table_stats|length|default:0 }}</span>
            </div>
            {% for table_name, count in table_stats %}
            <div class="metric-row">
              <span class="metric-label">{{ table_name|title|truncatechars:20 }}</span>
              <span class="metric-value">{{ count|default:0 }} records</span>
            </div>
            {% empty %}
            <div class="metric-row">
              <span class="metric-label">No data available</span>
              <span class="metric-value">-</span>
            </div>
            {% endfor %}
          </div>
        </div>

        <!-- Recent Activity -->
        <div class="analytics-card">
          <div class="stat-title">
            <span class="stat-icon">üìà</span>
            Recent Activity
          </div>
          <div class="activity-log">
            {% for activity in recent_activities|slice:":8" %}
            <div class="activity-item">
              <div class="activity-icon activity-{{ activity.action|lower }}">
                {% if activity.action == 'CREATE' %}+{% endif %}
                {% if activity.action == 'UPDATE' %}‚úèÔ∏è{% endif %}
                {% if activity.action == 'DELETE' %}√ó{% endif %}
                {% if activity.action == 'LOGIN' %}‚Üí{% endif %}
              </div>
              <div class="activity-content">
                <div class="activity-description">
                  {{ activity.description|truncatechars:45 }}
                </div>
                <div class="activity-time">
                  {% if activity.timestamp %}{{ activity.timestamp|timesince }} ago{% endif %}
                  {% if activity.user %} by {{ activity.user.username }}{% endif %}
                </div>
              </div>
            </div>
            {% empty %}
            <div style="text-align: center; color: var(--text-secondary); padding: 20px;">
              No recent activity to display
            </div>
            {% endfor %}
          </div>
        </div>

        
      </div>
    </div>
  </div>

  <!-- Floating Refresh Button -->
  <button class="refresh-indicator" onclick="refreshAnalytics()" title="Refresh Analytics">
    <span id="refreshIcon">üîÑ</span>
  </button>

  <!-- Analytics JavaScript -->
<script>
  let chartInstances = {};

// Refresh Analytics Function
function refreshAnalytics() {
  const refreshBtn = document.querySelector('.refresh-indicator');
  const refreshIcon = document.getElementById('refreshIcon');
  
  // Show loading state
  refreshBtn.classList.add('spinning');
  refreshBtn.disabled = true;
  
  // Make AJAX request to refresh data
  fetch('/refresh-analytics/')
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        // Update the displayed numbers
        document.getElementById('totalEmployees').textContent = data.data.total_employees || 0;
        document.getElementById('activeEmployees').textContent = data.data.active_employees || 0;
        document.getElementById('lastUpdated').textContent = data.data.timestamp;
        
        // Show success message
        showNotification('Analytics refreshed successfully!', 'success');
      } else {
        throw new Error(data.error || 'Unknown error');
      }
    })
    .catch(error => {
      console.error('Error refreshing analytics:', error);
      showNotification('Error refreshing data. Please try again.', 'error');
    })
    .finally(() => {
      // Remove loading state
      refreshBtn.classList.remove('spinning');
      refreshBtn.disabled = false;
    });
}

// Safe export function
function exportData(format) {
  try {
    const button = event.target;
    const originalText = button.innerHTML;
    
    // Show loading state
    button.disabled = true;
    button.innerHTML = `<span>‚è≥</span> Exporting...`;
    
    // Create download URL
    const url = `/employees_profile/?export=${format}`;
    
    // Create temporary download link
    const link = document.createElement('a');
    link.href = url;
    link.download = `employees_export_${new Date().toISOString().split('T')[0]}.${format}`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    
    // Reset button after delay
    setTimeout(() => {
      button.disabled = false;
      button.innerHTML = originalText;
      showNotification(`Data exported as ${format.toUpperCase()}`, 'success');
    }, 2000);
    
  } catch (error) {
    console.error('Export error:', error);
    showNotification('Export functionality temporarily unavailable.', 'error');
  }
}

// Show notification function
function showNotification(message, type = 'info') {
  // Create notification element
  const notification = document.createElement('div');
  notification.className = `notification notification-${type}`;
  notification.style.cssText = `
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 12px 24px;
    border-radius: 8px;
    color: white;
    font-weight: 500;
    z-index: 10000;
    transform: translateX(100%);
    transition: transform 0.3s ease;
  `;
  
  // Set background color based on type
  switch (type) {
    case 'success':
      notification.style.background = 'linear-gradient(135deg, #10b981, #059669)';
      break;
    case 'error':
      notification.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
      break;
    default:
      notification.style.background = 'linear-gradient(135deg, #3b82f6, #2563eb)';
  }
  
  notification.textContent = message;
  document.body.appendChild(notification);
  
  // Animate in
  setTimeout(() => {
    notification.style.transform = 'translateX(0)';
  }, 100);
  
  // Remove after 3 seconds
  setTimeout(() => {
    notification.style.transform = 'translateX(100%)';
    setTimeout(() => {
      document.body.removeChild(notification);
    }, 300);
  }, 3000);
}

// Chart data from Django template
const chartData = {
  departments: {
    labels: [
      {% if dept_stats %}
        {% for dept in dept_stats %}
          "{{ dept.department|default:'Unassigned'|escapejs }}"{% if not forloop.last %},{% endif %}
        {% endfor %}
      {% endif %}
    ],
    data: [
      {% if dept_stats %}
        {% for dept in dept_stats %}
          {{ dept.count|default:0 }}{% if not forloop.last %},{% endif %}
        {% endfor %}
      {% endif %}
    ]
  },
  tasks: {
    labels: [
      {% if task_stats %}
        {% for task in task_stats %}
          "{{ task.task|default:'Unassigned'|truncatechars:15|escapejs }}"{% if not forloop.last %},{% endif %}
        {% endfor %}
      {% endif %}
    ],
    data: [
      {% if task_stats %}
        {% for task in task_stats %}
          {{ task.count|default:0 }}{% if not forloop.last %},{% endif %}
        {% endfor %}
      {% endif %}
    ]
  },
  users: {
    labels: [
      {% if user_activity %}
        {% for user in user_activity %}
          "{{ user.user__username|default:'Unknown'|escapejs }}"{% if not forloop.last %},{% endif %}
        {% endfor %}
      {% endif %}
    ],
    data: [
      {% if user_activity %}
        {% for user in user_activity %}
          {{ user.login_count|default:0 }}{% if not forloop.last %},{% endif %}
        {% endfor %}
      {% endif %}
    ]
  }
};

// Initialize charts when page loads
function initializeCharts() {
  try {
    // Destroy existing charts
    Object.values(chartInstances).forEach(chart => {
      if (chart && typeof chart.destroy === 'function') {
        chart.destroy();
      }
    });
    chartInstances = {};

    // Department Chart
    const deptCanvas = document.getElementById('departmentChart');
    if (deptCanvas && chartData.departments.labels.length > 0) {
      const deptCtx = deptCanvas.getContext('2d');
      chartInstances.department = new Chart(deptCtx, {
        type: 'doughnut',
        data: {
          labels: chartData.departments.labels,
          datasets: [{
            data: chartData.departments.data,
            backgroundColor: [
              '#3b82f6', '#10b981', '#f59e0b', '#ef4444', 
              '#8b5cf6', '#06b6d4', '#84cc16', '#f97316'
            ],
            borderWidth: 2,
            borderColor: 'transparent'
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                padding: 15,
                usePointStyle: true
              }
            }
          }
        }
      });
    }

    // Task Chart
    const taskCanvas = document.getElementById('taskChart');
    if (taskCanvas && chartData.tasks.labels.length > 0) {
      const taskCtx = taskCanvas.getContext('2d');
      chartInstances.task = new Chart(taskCtx, {
        type: 'bar',
        data: {
          labels: chartData.tasks.labels,
          datasets: [{
            label: 'Employees',
            data: chartData.tasks.data,
            backgroundColor: 'rgba(59, 130, 246, 0.8)',
            borderColor: 'rgba(59, 130, 246, 1)',
            borderWidth: 1,
            borderRadius: 4
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: 'rgba(0,0,0,0.1)' }
            },
            x: {
              grid: { display: false }
            }
          },
          plugins: {
            legend: { display: false }
          }
        }
      });
    }

    // User Activity Chart
    const userCanvas = document.getElementById('userActivityChart');
    if (userCanvas && chartData.users.labels.length > 0) {
      const userCtx = userCanvas.getContext('2d');
      chartInstances.user = new Chart(userCtx, {
        type: 'bar',
        data: {
          labels: chartData.users.labels,
          datasets: [{
            label: 'Logins',
            data: chartData.users.data,
            backgroundColor: 'rgba(16, 185, 129, 0.8)',
            borderColor: 'rgba(16, 185, 129, 1)',
            borderWidth: 1,
            borderRadius: 4
          }]
        },
        options: {
          indexAxis: 'y',
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            x: {
              beginAtZero: true,
              grid: { color: 'rgba(0,0,0,0.1)' }
            },
            y: {
              grid: { display: false }
            }
          },
          plugins: {
            legend: { display: false }
          }
        }
      });
    }

  } catch (error) {
    console.error('Error initializing charts:', error);
  }
}

// Initialize charts when page loads
document.addEventListener('DOMContentLoaded', function() {
  initializeCharts();
  
  // Auto-refresh every 5 minutes
  setInterval(refreshAnalytics, 300000);
});

// Show error function
function showError(message) {
  showNotification(message, 'error');
}
// Global Theme Management System
    class GlobalThemeManager {
      constructor() {
        this.currentTheme = 'light';
        this.currentFontSize = 'medium';
        this.currentAnimationSpeed = 'normal';
        this.init();
      }

      init() {
        // Load saved preferences on every page load
        this.loadPreferences();
        // Apply saved theme immediately
        this.applyTheme(this.currentTheme);
        this.applyFontSize(this.currentFontSize);
        this.applyAnimationSpeed(this.currentAnimationSpeed);
        // Listen for system theme changes
        this.watchSystemTheme();
      }

      loadPreferences() {
        this.currentTheme = localStorage.getItem('theme') || 'light';
        this.currentFontSize = localStorage.getItem('fontSize') || 'medium';
        this.currentAnimationSpeed = localStorage.getItem('animationSpeed') || 'normal';
      }

      applyTheme(theme) {
        const html = document.documentElement;
        
        // Add transition class for smooth theme switching
        html.classList.add('theme-transition');
        
        // Set theme attribute
        html.setAttribute('data-theme', theme);
        
        // Store current theme
        this.currentTheme = theme;
        localStorage.setItem('theme', theme);

        // Remove transition class after animation
        setTimeout(() => {
          html.classList.remove('theme-transition');
        }, 300);

        // Update theme selector if it exists on the page
        const themeSelector = document.getElementById('change-theme');
        if (themeSelector) {
          themeSelector.value = theme;
        }
      }

      applyFontSize(size) {
        const root = document.documentElement;
        const sizeMap = {
          'small': '14px',
          'medium': '16px',
          'large': '18px'
        };
        
        root.style.fontSize = sizeMap[size];
        this.currentFontSize = size;
        localStorage.setItem('fontSize', size);

        // Update font size selector if it exists
        const fontSizeSelector = document.getElementById('font-size');
        if (fontSizeSelector) {
          fontSizeSelector.value = size;
        }
      }

      applyAnimationSpeed(speed) {
        const root = document.documentElement;
        const speedMap = {
          'slow': '0.6s',
          'normal': '0.3s',
          'fast': '0.15s',
          'none': '0s'
        };
        
        root.style.setProperty('--transition-duration', speedMap[speed]);
        this.currentAnimationSpeed = speed;
        localStorage.setItem('animationSpeed', speed);

        // Update all transition durations
        const style = document.createElement('style');
        style.textContent = `
          .theme-transition * {
            transition-duration: ${speedMap[speed]} !important;
          }
        `;
        
        // Remove previous speed style if exists
        const oldStyle = document.getElementById('animation-speed-style');
        if (oldStyle) oldStyle.remove();
        
        style.id = 'animation-speed-style';
        document.head.appendChild(style);

        // Update animation speed selector if it exists
        const animationSpeedSelector = document.getElementById('animation-speed');
        if (animationSpeedSelector) {
          animationSpeedSelector.value = speed;
        }
      }

      watchSystemTheme() {
        if (window.matchMedia) {
          const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
          mediaQuery.addListener((e) => {
            if (this.currentTheme === 'auto') {
              // Force re-application of auto theme
              this.applyTheme('auto');
            }
          });
        }
      }

      // Method to change theme programmatically
      setTheme(theme) {
        this.applyTheme(theme);
      }

      // Method to get current theme
      getTheme() {
        return this.currentTheme;
      }

      // Method to toggle between light and dark
      toggleTheme() {
        const newTheme = this.currentTheme === 'light' ? 'dark' : 'light';
        this.applyTheme(newTheme);
        return newTheme;
      }

      showSuccessMessage(message) {
        // Remove existing message if any
        const existing = document.querySelector('.success-message');
        if (existing) existing.remove();

        // Create new message
        const messageEl = document.createElement('div');
        messageEl.className = 'success-message';
        messageEl.textContent = message;
        document.body.appendChild(messageEl);

        // Show message
        setTimeout(() => messageEl.classList.add('show'), 100);

        // Hide and remove message
        setTimeout(() => {
          messageEl.classList.remove('show');
          setTimeout(() => messageEl.remove(), 300);
        }, 3000);
      }
    }

    // Initialize global theme manager
    let globalThemeManager;

    // Initialize when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      globalThemeManager = new GlobalThemeManager();
      
      // Add event listeners if theme controls exist on current page
      const themeSelector = document.getElementById('change-theme');
      if (themeSelector) {
        themeSelector.addEventListener('change', function(e) {
          globalThemeManager.setTheme(e.target.value);
        });
      }

      const fontSizeSelector = document.getElementById('font-size');
      if (fontSizeSelector) {
        fontSizeSelector.addEventListener('change', function(e) {
          globalThemeManager.applyFontSize(e.target.value);
        });
      }

      const animationSpeedSelector = document.getElementById('animation-speed');
      if (animationSpeedSelector) {
        animationSpeedSelector.addEventListener('change', function(e) {
          globalThemeManager.applyAnimationSpeed(e.target.value);
        });
      }
    });

    // Make theme manager globally accessible
    window.globalThemeManager = globalThemeManager;

    // Global functions
    function toggleTheme() {
      if (window.globalThemeManager) {
        return window.globalThemeManager.toggleTheme();
      }
    }
    // Mobile Menu Functionality
document.addEventListener('DOMContentLoaded', function() {
  // Create mobile menu toggle button if it doesn't exist
  if (window.innerWidth <= 768) {
    createMobileMenuToggle();
  }
  
  // Handle window resize
  window.addEventListener('resize', function() {
    if (window.innerWidth <= 768) {
      if (!document.querySelector('.mobile-menu-toggle')) {
        createMobileMenuToggle();
      }
    } else {
      const mobileToggle = document.querySelector('.mobile-menu-toggle');
      if (mobileToggle) {
        mobileToggle.remove();
      }
      // Ensure sidebar is visible on larger screens
      const sidebar = document.querySelector('.sidebar');
      if (sidebar) {
        sidebar.classList.remove('open');
      }
    }
  });
});

function createMobileMenuToggle() {
  // Check if toggle already exists
  if (document.querySelector('.mobile-menu-toggle')) {
    return;
  }
  
  const toggleButton = document.createElement('button');
  toggleButton.className = 'mobile-menu-toggle';
  toggleButton.innerHTML = '‚ò∞';
  toggleButton.setAttribute('aria-label', 'Toggle Menu');
  
  // Add click event listener
  toggleButton.addEventListener('click', toggleMobileMenu);
  
  // Add to body
  document.body.appendChild(toggleButton);
}

function toggleMobileMenu() {
  const sidebar = document.querySelector('.sidebar');
  const toggle = document.querySelector('.mobile-menu-toggle');
  
  if (sidebar && toggle) {
    sidebar.classList.toggle('open');
    
    // Update button text
    if (sidebar.classList.contains('open')) {
      toggle.innerHTML = '√ó';
    } else {
      toggle.innerHTML = '‚ò∞';
    }
  }
}

// Close mobile menu when clicking outside
document.addEventListener('click', function(event) {
  const sidebar = document.querySelector('.sidebar');
  const toggle = document.querySelector('.mobile-menu-toggle');
  
  if (sidebar && toggle && window.innerWidth <= 768) {
    if (!sidebar.contains(event.target) && !toggle.contains(event.target)) {
      sidebar.classList.remove('open');
      toggle.innerHTML = '‚ò∞';
    }
  }
});

// Close mobile menu when clicking on a nav link
document.addEventListener('click', function(event) {
  if (event.target.matches('.nav-menu a') && window.innerWidth <= 768) {
    const sidebar = document.querySelector('.sidebar');
    const toggle = document.querySelector('.mobile-menu-toggle');
    
    if (sidebar && toggle) {
      sidebar.classList.remove('open');
      toggle.innerHTML = '‚ò∞';
    }
  }
});
</script>
</body>
</html>